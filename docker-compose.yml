version: '3.5'
services:
  peercoind:
    restart: always
    image: peerchemist/peercoind
    ports:
      - "19904:19904"
    environment:
      - RPC_USER=papi
      - RPC_PASSWORD=papipass
    volumes:
      - type: bind
        source: /opt/papi/peercoin/
        target: /data
    command:
      -testnet
      -rpcallowip=*
      -rpcport=19904
      -walletnotify='/app/transaction.py %s'
  postgres:
    image: postgres:9.6
    environment:
      - POSTGRES_PASSWORD=papipass
      - POSTGRES_USER=docker
      - POSTGRES_DB=papi
    ports:
      - "5432:5432"
    volumes:
      - /data/postgres:/data/postgres
    restart: always
    links:
      - peercoind
  papi:
    restart: always
    build: .
    ports:
      - "5555:5555"
    depends_on:
      - peercoind
      - postgres
    environment:
      - PA_TESTNET=true
      - PA_PRODUCTION=true
      - AUTOLOAD=true
      - PA_VERSION=1
      - RPC_HOST=peercoind
      - RPC_PORT=19904
      - RPC_USERNAME=papi
      - RPC_PASSWORD=papipass
    command: ["peercoind:19904"]